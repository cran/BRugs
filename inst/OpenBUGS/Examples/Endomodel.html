<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Endomodel</title></head><body><p><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;model<br>&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;# transform collapsed data into full<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in 1 : I){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i,1] &lt;- 1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i,2] &lt;- 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# loop around strata with case exposed, control not exposed (n10)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in 1 : n10){ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,1] &lt;- 1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,2] &lt;- 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# loop around strata with case not exposed, control exposed (n01)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in (n10+1) : (n10+n01)){ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,1] &lt;- 0 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,2] &lt;- 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# loop around strata with case exposed, control exposed (n11)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in (n10+n01+1) : (n10+n01+n11)){ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,1] &lt;- 1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,2] &lt;- 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# loop around strata with case not exposed, control not exposed (n00)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in (n10+n01+n11+1) :I ){ <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,1] &lt;- 0 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;est[i,2] &lt;- 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;# PRIORS<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beta ~ dnorm(0,1.0E-6) ; <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;# LIKELIHOOD<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in 1 : I) { # loop around strata&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># METHOD 1 - logistic regression<br>&nbsp;&nbsp;&nbsp;# Y[i,1] ~ dbin( p[i,1], 1) <br>&nbsp;&nbsp;&nbsp;# logit(p[i,1]) &lt;- beta * (est[i,1] - est[i,J]) <br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;# METHOD 2 - conditional likelihoods<br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i, 1 : J] ~ dmulti( p[i, 1 : J],1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j in 1:2){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p[i, j] &lt;- e[i, j] / sum(e[i, ])<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log( e[i, j] ) &lt;- beta * est[i, j] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;# METHOD 3 fit standard Poisson regressions relative to baseline<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">#for (j in 1:J) { <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">#&nbsp;&nbsp;&nbsp;Y[i, j] ~ dpois(mu[i, j]);<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">#&nbsp;&nbsp;&nbsp;log(mu[i, j]) &lt;- beta0[i] + beta*est[i, j]; <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;} <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">#beta0[i] ~ dnorm(0, 1.0E-6) </font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;}<br></font></p></body></html>