<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Leukfr</title></head><body><p><font face="Arial" color="#000100" size="2"></font><font face="Arial" color="#000100" size="3"><strong><img src="bugsicon.jpg" alt="[bugsicon]"></strong></font><font face="Arial" color="#0000FF" size="5"><strong>&nbsp;&nbsp;&nbsp;LeukFr: Cox regression with random effects<br></strong></font><font face="Arial" color="#0000FF" size="2"><strong><br></strong></font><font face="Arial" color="#000100" size="3">Freireich et al (1963)'s data presented in the </font><font face="Courier" color="#000100" size="3">Leuk</font><font face="Arial" color="#000100" size="3"> example actually arise via a </font><font face="Arial" color="#000100" size="3"><em>paired</em></font><font face="Arial" color="#000100" size="3"> design. Patients were matched according to their remission status (partial or complete). One patient from each pair received the drug 6-MP whilst the other received the placebo. We may introduce an additional vector (called </font><font face="Courier" color="#000100" size="3">pair</font><font face="Arial" color="#000100" size="3">) in the BUGS data file to indicate each of the 21 pairs of patients.<br><br>We model the potential 'clustering' of failure times within pairs of patients by introducing a group-specific random effect or frailty term into the proportional hazards model. Using the counting process notation introduced in the </font><font face="Courier" color="#000100" size="3">Leuk</font><font face="Arial" color="#000100" size="3"> example, this gives<br><br><br>&nbsp;&nbsp;&nbsp;I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">(t) dt&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;Y</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">(t) exp( </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="3">' z</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> + b</font><font face="Arial" color="#000100" size="2"><sub>pair</sub></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> ) d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t)&nbsp;&nbsp;&nbsp;i = 1,...,42;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="2">pair</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">= 1,...,21<br>&nbsp;&nbsp;&nbsp;b</font><font face="Arial" color="#000100" size="2"><sub>pair</sub></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub>&nbsp;&nbsp;&nbsp;</sub></font><font face="Arial" color="#000100" size="3">~</font><font face="Arial" color="#000100" size="3"><sub>&nbsp;&nbsp;&nbsp;</sub></font><font face="Arial" color="#000100" size="3">Normal(0, </font><font face="Symbol" color="#000100" size="3">t</font><font face="Arial" color="#000100" size="3">) <br><br>A non-informative Gamma prior is assumed for </font><font face="Symbol" color="#000100" size="3">t</font><font face="Arial" color="#000100" size="3">, the precision of the frailty parameters. Note that the above 'additive' formualtion of the frailty model is equivalent to assuming multiplicative frailties with a log-Normal population distibution. Clayton (1991) discusses the Cox proportional hazards model with multiplicative frailties, but assumes a Gamma population distribution. <br><br>The modified BUGS code needed to include a fraility term in the </font><font face="Courier" color="#000100" size="3">Leuk</font><font face="Arial" color="#000100" size="3"> example is shown below<br></font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;model<br>&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;# Set up data<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for(i in 1 : N) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1 : T) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># risk set = 1 if obs.t &gt;= t<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i, j] &lt;- step(obs.t[i] - t[j] + eps) <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># counting process jump = 1 if obs.t in [ t[j], t[j+1] )<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># i.e. if t[j] &lt;= obs.t &lt; t[j+1]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] &lt;- Y[i, j ] *step(t[j+1] - obs.t[i] - eps)*fail[i] <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# Model <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1 : T) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in 1 : N) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] ~ dpois(Idt[i, j]) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idt[i, j] &lt;- Y[i, j] * exp(beta * Z[i]+b[pair[i]]) * dL0[j] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0[j] ~ dgamma(mu[j], c)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[j] &lt;- dL0.star[j] * c # prior mean hazard<br>&nbsp;&nbsp;&nbsp;# Survivor function = exp(-Integral{l0(u)du})^exp(beta * z) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.treat[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * -0.5))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.placebo[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * 0.5))&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(k in 1 : Npairs) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b[k] ~ dnorm(0.0, tau);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tau ~ dgamma(0.001, 0.001)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigma &lt;- sqrt(1 / tau)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c &lt;- 0.001 r &lt;- 0.1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j in 1 : T) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0.star[j] &lt;- r * (t[j+1]-t[j]) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beta ~ dnorm(0.0,0.000001) <br>&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000100" size="1"><br><br><br></font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Leukfdata.html"></font><font face="Arial" color="#0000FF" size="5"><u>Data</u></font><font face="Arial" color="#0000FF" size="5"></a></font><font face="Arial" color="#000100" size="3"> ( click to open )</font><font face="Arial" color="#000000" size="2"><br><br></font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Leukfinits.html"></font><font face="Arial" color="#0000FF" size="5"><u>Inits</u></font><font face="Arial" color="#0000FF" size="5"></a></font><font face="Arial" color="#000100" size="3"> ( click to open )</font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#000100" size="1"><br><br></font><font face="Arial" color="#0000FF" size="5">Results <br></font><font face="Arial" color="#000000" size="3"><br>A 1000 update burn in followed by a further 10000 updates gave the parameter estimates<br><center><br></font><font face="Arial" color="#000000" size="2"><img src="leukfr1.jpg" alt="[leukfr1]"></font><font face="Arial" color="#000100" size="1"><br></center><br><br><br></font></p></body></html>