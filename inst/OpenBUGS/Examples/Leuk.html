<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Leuk</title></head><body><p><font face="Arial" color="#000100" size="2"></font><font face="Arial" color="#000100" size="3"><strong><img src="leuk0.bmp" alt="[leuk0]">&nbsp;&nbsp;&nbsp;</strong></font><font face="Courier New" color="#000100" size="6">Leuk: Cox regression</font><font face="Arial" color="#000000" size="5"><strong><br><br></strong></font><font face="Arial" color="#000100" size="3">Several authors have discussed Bayesian inference for censored survival data where the integrated baseline hazard function is to be estimated non-parametrically Kalbfleisch (1978) ,Kalbfleisch and Prentice (1980), Clayton (1991), Clayton (1994).Clayton (1994) formulates the Cox model using the counting process notation introduced by Andersen and Gill (1982) and discusses estimation of the baseline hazard and regression parameters using MCMC methods. Although his approach may appear somewhat contrived, it forms the basis for extensions to random effect (frailty) models, time-dependent covariates, smoothed hazards, multiple events and so on. We show below how to implement this formulation of the Cox model in </font><font face="Arial" color="#000100" size="3"><em>BUGS</em></font><font face="Arial" color="#000100" size="3">.<br><br>For subjects </font><font face="Arial" color="#000100" size="3"><em>i</em></font><font face="Arial" color="#000100" size="3"> = 1,...,n, we observe processes N</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) which count the number of failures which have occurred up to time t. The corresponding intensity process I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) is given by<br><br>&nbsp;&nbsp;&nbsp;I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)dt = E(dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) | F</font><font face="Arial" color="#000100" size="3"><sub>t-</sub></font><font face="Arial" color="#000100" size="3">)<br>&nbsp;&nbsp;&nbsp;<br>where dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) is the increment of N</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> over the small time interval [t, t+dt), and F</font><font face="Arial" color="#000100" size="3"><sub>t-</sub></font><font face="Arial" color="#000100" size="3"> represents the available data just before time t. If subject </font><font face="Arial" color="#000100" size="3"><em>i</em></font><font face="Arial" color="#000100" size="3"> is observed to fail during this time interval, dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) will take the value 1; otherwise dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) = 0. Hence E(dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) | F</font><font face="Arial" color="#000100" size="3"><sub>t-</sub></font><font face="Arial" color="#000100" size="3">) corresponds to the probability of subject</font><font face="Arial" color="#000100" size="3"><em> i</em></font><font face="Arial" color="#000100" size="3"> failing in the interval [t, t+dt). As dt -&gt; 0 (assuming time to be continuous) then this probability becomes the instantaneous hazard at time t for subject </font><font face="Arial" color="#000100" size="3"><em>i</em></font><font face="Arial" color="#000100" size="3">. This is assumed to have the proportional hazards form&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) = Y</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)</font><font face="Symbol" color="#000100" size="3">l</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t)exp(</font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"><strong>z</strong></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">)<br>&nbsp;&nbsp;&nbsp;<br>where Y</font><font face="Arial" color="#000100" size="3"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) is an observed process taking the value 1 or 0 according to whether or not subject </font><font face="Arial" color="#000100" size="3"><em>i</em></font><font face="Arial" color="#000100" size="3"> is observed at time t and </font><font face="Symbol" color="#000100" size="3">l</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t)exp(</font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"><strong>z</strong></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">) is the familiar Cox regression model. Thus we have observed data D = N</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t), Y</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t), </font><font face="Arial" color="#000100" size="3"><strong>z</strong></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">; i = 1,..n and unknown parameters </font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"> and </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) = Integral(</font><font face="Symbol" color="#000100" size="3">l</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(u), u, t, 0), the latter to be estimated non-parametrically. &nbsp;&nbsp;&nbsp;<br><br>The joint posterior distribution for the above model is defined by<br><br>&nbsp;&nbsp;&nbsp;P(</font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">() | D) ~ P(D | </font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">()) P(</font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3">) P(</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">())<br>&nbsp;&nbsp;&nbsp;<br>For </font><font face="Arial" color="#000100" size="3"><em>BUGS</em></font><font face="Arial" color="#000100" size="3">, we need to specify the form of the likelihood P(D | </font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">()) and prior distributions for </font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"> and </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(). Under non-informative censoring, the likelihood of the data is proportional to&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="2">n</font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="5">P</font><font face="Arial" color="#000100" size="5">[</font><font face="Symbol" color="#000100" size="5">P</font><font face="Arial" color="#000100" size="5"> </font><font face="Symbol" color="#000100" size="3">I</font><font face="Arial" color="#000100" size="3"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)</font><font face="Arial" color="#000100" size="3"><sup>dN</sup></font><font face="Arial" color="#000100" size="3"><sup>i</sup></font><font face="Arial" color="#000100" size="3"><sup>(t)</sup></font><font face="Arial" color="#000100" size="5">] </font><font face="Arial" color="#000100" size="3">exp(- I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)dt)<br>&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="2">i = 1 t &gt;= 0</font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<br>This is essentially as if the counting process increments dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) in the time interval [t, t+dt) are independent Poisson random variables with means I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)dt:&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;dN</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t) ~ Poisson(I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)dt)<br>&nbsp;&nbsp;&nbsp;<br>We may write&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;I</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)dt = Y</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">(t)exp(</font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"><strong>z</strong></font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3">)d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t)<br>&nbsp;&nbsp;&nbsp;<br>where d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) = </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t)dt is the increment or jump in the integrated baseline hazard function occurring during the time interval [t, t+dt). Since the conjugate prior for the Poisson mean is the gamma distribution, it would be convenient if </font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">() were a process in which the increments d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="3"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) are distributed according to gamma distributions. We assume the conjugate independent increments prior suggested by Kalbfleisch (1978), namely&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) ~ Gamma(cd</font><font face="Symbol" color="#000100" size="3">L</font><font face="Symbol" color="#000100" size="3"><sup>*</sup></font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t), c)<br>&nbsp;&nbsp;&nbsp;<br>Here, d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Symbol" color="#000100" size="3"><sup>*</sup></font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) can be thought of as a prior guess at the unknown hazard function, with c representing the degree of confidence in this guess. Small values of c correspond to weak prior beliefs. In the example below, we set d</font><font face="Symbol" color="#000100" size="3">L</font><font face="Symbol" color="#000100" size="3"><sup>*</sup></font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">(t) = r dt where r is a guess at the failure rate per unit time, and dt is the size of the time interval. &nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;<br>The above formulation is appropriate when genuine prior information exists concerning the underlying hazard function. Alternatively, if we wish to reproduce a Cox analysis but with, say, additional hierarchical structure, we may use the multinomial-Poisson trick described in the </font><font face="Arial" color="#000100" size="3"><em>BUGS</em></font><font face="Arial" color="#000100" size="3"> manual. This is equivalent to assuming independent increments in the cumulative `non-informative' priors. This formulation is also shown below.<br><br>The fixed effect regression coefficients </font><font face="Symbol" color="#000100" size="3"><strong>b</strong></font><font face="Arial" color="#000100" size="3"> are assigned a vague prior<br><br>&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="3"> ~ Normal(0.0, 0.000001)<br>&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="2">&nbsp;&nbsp;&nbsp;<center></font><font face="Arial" color="#000100" size="3">BUGS</font><font face="Arial" color="#000100" size="3"><em> language for the Leuk example:</em></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3"><br></center>&nbsp;&nbsp;&nbsp;model<br>&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;# Set up data<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in 1:N) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1:T) {<br>&nbsp;&nbsp;&nbsp;# risk set = 1 if obs.t &gt;= t<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i,j] &lt;- step(obs.t[i] - t[j] + eps)<br>&nbsp;&nbsp;&nbsp;# counting process jump = 1 if obs.t in [ t[j], t[j+1] )<br>&nbsp;&nbsp;&nbsp;# i.e. if t[j] &lt;= obs.t &lt; t[j+1]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] &lt;- Y[i, j] * step(t[j + 1] - obs.t[i] - eps) * fail[i]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# Model <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1:T) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in 1:N) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] ~ dpois(Idt[i, j]) # Likelihood<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idt[i, j] &lt;- Y[i, j] * exp(beta * Z[i]) * dL0[j] &nbsp;&nbsp;&nbsp;# Intensity <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0[j] ~ dgamma(mu[j], c)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[j] &lt;- dL0.star[j] * c # prior mean hazard<br><br>&nbsp;&nbsp;&nbsp;# Survivor function = exp(-Integral{l0(u)du})^exp(beta*z) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.treat[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * -0.5));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.placebo[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * 0.5));&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c &lt;- 0.001<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r &lt;- 0.1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j in 1 : T) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0.star[j] &lt;- r * (t[j + 1] - t[j]) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beta ~ dnorm(0.0,0.000001) <br>&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000100" size="1"><br></font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Leukdata.html"></font><font face="Arial" color="#0000FF" size="5"><u>Data</u></font><font face="Arial" color="#0000FF" size="5"></a></font><font face="Arial" color="#000100" size="3"> ( click to open )</font><font face="Arial" color="#000000" size="2"><br><br></font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Leukinits.html"></font><font face="Arial" color="#0000FF" size="5"><u>Inits</u></font><font face="Arial" color="#0000FF" size="5"></a></font><font face="Arial" color="#000100" size="3"> ( click to open )</font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#000100" size="1"><br></font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#0000FF" size="5">Results</font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#000000" size="3"><br>A 1000 update burn in followed by a further 10000 updates gave the parameter estimates<br><center><br></font><font face="Arial" color="#000000" size="2"><img src="leuk1.bmp" alt="[leuk1]"></center></font></p></body></html>