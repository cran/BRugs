<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Leukfrmodel</title></head><body><p><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;model<br>&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;# Set up data<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for(i in 1 : N) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1 : T) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># risk set = 1 if obs.t &gt;= t<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i, j] &lt;- step(obs.t[i] - t[j] + eps) <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># counting process jump = 1 if obs.t in [ t[j], t[j+1] )<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># i.e. if t[j] &lt;= obs.t &lt; t[j+1]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] &lt;- Y[i, j ] *step(t[j+1] - obs.t[i] - eps)*fail[i] <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;# Model <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in 1 : T) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in 1 : N) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dN[i, j] ~ dpois(Idt[i, j]) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Idt[i, j] &lt;- Y[i, j] * exp(beta * Z[i]+b[pair[i]]) * dL0[j] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0[j] ~ dgamma(mu[j], c)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[j] &lt;- dL0.star[j] * c # prior mean hazard<br>&nbsp;&nbsp;&nbsp;# Survivor function = exp(-Integral{l0(u)du})^exp(beta * z) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.treat[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * -0.5))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S.placebo[j] &lt;- pow(exp(-sum(dL0[1 : j])), exp(beta * 0.5))&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(k in 1 : Npairs) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b[k] ~ dnorm(0.0, tau);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tau ~ dgamma(0.001, 0.001)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigma &lt;- sqrt(1 / tau)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c &lt;- 0.001 r &lt;- 0.1 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j in 1 : T) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dL0.star[j] &lt;- r * (t[j+1]-t[j]) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beta ~ dnorm(0.0,0.000001) <br>&nbsp;&nbsp;&nbsp;}<br></font></p></body></html>