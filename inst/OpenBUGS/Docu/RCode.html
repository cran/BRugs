<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>RCode</title></head><body><p><font face="Arial" color="#000100" size="1">#<img src="bugsicon.jpg" alt="[bugsicon]">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="2"><a href="../Docu/GNU-Licence.html"></font><font face="Arial" color="#0000FF" size="2"><u>GNU&nbsp;General&nbsp;Public&nbsp;License</u></font><font face="Arial" color="#000100" size="2"></a></font><font face="Arial" color="#000100" size="1"><br><br></font><font face="Arial" color="#008040" size="3">################################################################<br>################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BRugs a minimal R interface to OpenBUGS <br>#<br>###############################################################<br>###############################################################<br><br>###############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;The directory structure of the OpenBUGS software must be preseved. The<br>#&nbsp;&nbsp;&nbsp;path variable &quot;root&quot; must be set to the root directory where OpenBUGS is installed.<br>#&nbsp;&nbsp;&nbsp;The path variable &quot;brugs&quot; is the location of the dynamic link library / shared<br>#&nbsp;&nbsp;&nbsp;object<br>#&nbsp;&nbsp;&nbsp;file that allows R to access OpenBUGS. The path variable &quot;buffer&quot; is the location of<br>#&nbsp;&nbsp;&nbsp;a buffer file that OpenBUGS write to and R reads from. The path variable &quot;examples&quot;<br>#&nbsp;&nbsp;&nbsp;is where the OpenBUGS model specification, data and initial value files are stored.<br>#<br>#&nbsp;&nbsp;&nbsp;The R function .First.lib loads the BRugs package and the function .Last.lib<br>#&nbsp;&nbsp;&nbsp;cleans up any tempory R objects that BRugs has created.<br>#<br>#&nbsp;&nbsp;&nbsp;The following R function provide the user interface to BRugs<br>#<br>#&nbsp;&nbsp;&nbsp;model.check,&nbsp;&nbsp;&nbsp;model.data,&nbsp;&nbsp;&nbsp;model.compile,&nbsp;&nbsp;&nbsp;model.inits,&nbsp;&nbsp;&nbsp;model.gen.inits,<br>#<br>#&nbsp;&nbsp;&nbsp;model.adaptivePhase,&nbsp;&nbsp;&nbsp;model.iteration,&nbsp;&nbsp;&nbsp;model.update,<br>#<br>#&nbsp;&nbsp;&nbsp;model.set.seed,&nbsp;&nbsp;&nbsp;model.get.seed,&nbsp;&nbsp;&nbsp;model.precision,&nbsp;&nbsp;&nbsp;model.save.state,<br>#<br>#&nbsp;&nbsp;&nbsp;model.setAP,&nbsp;&nbsp;&nbsp;model.setIts,&nbsp;&nbsp;&nbsp;model.setOR,<br>#<br>#&nbsp;&nbsp;&nbsp;samples.set,&nbsp;&nbsp;&nbsp;samples.clear,&nbsp;&nbsp;&nbsp;samples.stats,&nbsp;&nbsp;&nbsp;samples.history,&nbsp;&nbsp;&nbsp;samples.autoC,<br>#&nbsp;&nbsp;&nbsp;samples.density,&nbsp;&nbsp;&nbsp;samples.bgr,&nbsp;&nbsp;&nbsp;samples.correl,&nbsp;&nbsp;&nbsp;samples.coda,<br>#<br>#&nbsp;&nbsp;&nbsp;samples.size,&nbsp;&nbsp;&nbsp;samples.sample,&nbsp;&nbsp;&nbsp;samples.monitors,&nbsp;&nbsp;&nbsp;<br>#&nbsp;&nbsp;&nbsp;samples.set.beg,&nbsp;&nbsp;&nbsp;samples.set.end,&nbsp;&nbsp;&nbsp;samples.set.firstChain,&nbsp;&nbsp;&nbsp;samples.set.lastChain,<br>#&nbsp;&nbsp;&nbsp;samples.set.thin,<br>#<br>#&nbsp;&nbsp;&nbsp;samples.get.beg,&nbsp;&nbsp;&nbsp;samples.get.end,&nbsp;&nbsp;&nbsp;samples.get.firstChain,&nbsp;&nbsp;&nbsp;samples.get.lastChain,<br># samples.get.thin,<br>#&nbsp;&nbsp;&nbsp;<br>#&nbsp;&nbsp;&nbsp;summary.set,&nbsp;&nbsp;&nbsp;summary.stats,&nbsp;&nbsp;&nbsp;summary.clear,<br>#<br>#&nbsp;&nbsp;&nbsp;ranks.set,&nbsp;&nbsp;&nbsp;ranks.stats,&nbsp;&nbsp;&nbsp;ranks.clear,<br>#<br>#&nbsp;&nbsp;&nbsp;dic.set,&nbsp;&nbsp;&nbsp;dic.stats,&nbsp;&nbsp;&nbsp;dic.clear<br>#<br>#&nbsp;&nbsp;&nbsp;In general these function correspond to buttons in the dialog boxes of the OpenBUGS GUI. <br>#&nbsp;&nbsp;&nbsp;The arguments of these functions correspond to text entry fields in the dialog boxes.<br>#&nbsp;&nbsp;&nbsp;See the OpenBUGS documentation for details. Usually there are two R function for<br>#&nbsp;&nbsp;&nbsp;each OpenBUGS text entry field one to set the value of the field and the other to get<br>#&nbsp;&nbsp;&nbsp;the value of the field.<br>#<br>###############################################################<br><br>###############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;List loaded OpenBUGS components<br>#<br>###############################################################<br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.modules&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;List loaded OpenBUGS components<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsEmbed.Modules&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>}<br><br></font><font face="Arial" color="#008040" size="3">###############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load module<br>#<br>###############################################################<br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;loadModule&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(module)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load module<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- as.character(module)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;Load&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br><br></font><font face="Arial" color="#008040" size="3">###############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loading and unloading BRugs<br>#<br>###############################################################<br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;examples&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- &quot;&quot;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;examples directory<br><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;root&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- &quot;c:/OpenBUGS&quot;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;root of OpenBUGS directory structure<br><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;tempDir&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- &quot;c:/temp&quot;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;temp directory used for buffer file<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Set the root of OpenBUGS directory structure<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;setRootDir&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(root)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the root of OpenBUGS directory structure<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(root)<br>&nbsp;&nbsp;&nbsp;.C(&quot;SetRootDir&quot;, as.character(root), as.integer(len))<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Set the temp directory used by OpenBUGS<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;setTempDir&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(temp)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the temp directory used by OpenBUGS<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(tempDir)<br>&nbsp;&nbsp;&nbsp;.C(&quot;SetTempDir&quot;, as.character(tempDir), as.integer(len))<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;load BRugs library, sets path / file variables and initializes subsystems<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;.First.lib&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(){<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;load BRugs library, sets path / file variables and initializes subsystems<br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;brugs &lt;- paste(root, &quot;/brugs&quot;, .Platform$dynlib.ext, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;dyn.load(brugs)<br>&nbsp;&nbsp;&nbsp;setRootDir(root)<br>&nbsp;&nbsp;&nbsp;setTempDir(tempDir)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;INIT()&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;EmbedCommand&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;Wecome to BRugs running on OpenBUGS version 2.0&quot;, &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;unload BRugs and deleteR objects corresponding to names in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;.Last.lib&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(){<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;unload BRugs library<br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;deleteRObjs()<br>&nbsp;&nbsp;&nbsp;brugs &lt;- paste(root, &quot;/brugs&quot;, .Platform$dynlib.ext, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;dyn.unload(brugs)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Linking between quantities in OpenBUGS model and R<br>#<br>#&nbsp;&nbsp;&nbsp;R objects of the correct dimensions are created for each name in the OpenBUGS<br>#&nbsp;&nbsp;&nbsp;model. This allows R objects to be used as arguments of BRugs functions instead<br>#&nbsp;&nbsp;&nbsp;of having to use character strings.<br>#&nbsp;&nbsp;&nbsp;There is a problem here if names in the OpenBUGS model collide with names<br>#&nbsp;&nbsp;&nbsp;of other R objects!<br>#<br>#############################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;gets names in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.names&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br>{<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;gets names in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsRobjects.Names&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;readLines(buffer)<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Get dimension information for quantity in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;dimensions&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get dimension information for quantity in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;nodeLabel &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;lenLabel &lt;- nchar(nodeLabel)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsRobjects.Set&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CharArray&quot;, as.character(command), as.integer(len), as.character(nodeLabel),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(lenLabel), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsRobjects.NumSlots&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;numSlots &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;dimensions &lt;- integer(numSlots)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsRobjects.Dimensions&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;if (numSlots &gt; 0) dimensions &lt;- .C(&quot;IntegerArray&quot;, as.character(command), as.integer(len),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(dimensions), as.integer(numSlots), integer(1))[[3]]<br>&nbsp;&nbsp;&nbsp;else dimensions &lt;- NULL<br>&nbsp;&nbsp;&nbsp;dimensions<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;create an R object to represent name in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;createRObj&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(name)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;create an R object to represent name in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;dimens &lt;- dimensions(name)<br>&nbsp;&nbsp;&nbsp;numSlots &lt;- length(dimens)<br>&nbsp;&nbsp;&nbsp;size &lt;- 1<br>&nbsp;&nbsp;&nbsp;if (numSlots &gt; 0) for(i in 1:numSlots) {size &lt;- size * dimens[i]}<br>&nbsp;&nbsp;&nbsp;indices &lt;- &quot;&quot;<br>&nbsp;&nbsp;&nbsp;if (numSlots &gt; 0) indices &lt;- as.character(dimens[1])<br>&nbsp;&nbsp;&nbsp;if (numSlots &gt; 1) for (i in 2:numSlots) { indices &lt;- paste(indices, &quot;,&quot;, as.character(dimens[i])) }<br>&nbsp;&nbsp;&nbsp;if (numSlots == 0) string &lt;- paste(name, &quot; &lt;- real(1)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else string &lt;- paste(name, &quot; &lt;- structure(real(&quot;, as.character(size), &quot;), dim = c(&quot;,<br>&nbsp;&nbsp;&nbsp;indices, &quot;))&quot;,sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;e &lt;- parse(text = string)<br>&nbsp;&nbsp;&nbsp;eval(e, envir = .GlobalEnv)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Create R objects for each name in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;createRObjs&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Create R objects for each name in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;names &lt;- model.names()<br>&nbsp;&nbsp;&nbsp;junk &lt;- lapply(names, createRObj)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Delete R object corresponding to name in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;deleteRObj&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(name)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Delete R object corresponding to name in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;string &lt;- paste(&quot;rm(&quot;, name, &quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;e &lt;- parse(text = string)<br>&nbsp;&nbsp;&nbsp;eval(e, envir = .GlobalEnv)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Delete all R objects corresponding to a name in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;deleteRObjs&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Delete all R objects corresponding to a name in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;names &lt;- model.names()<br>&nbsp;&nbsp;&nbsp;junk &lt;- lapply(names, deleteRObj)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>##########################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Model specification<br>#<br>##########################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Check that OpenBUGS model is sytaxticaly correct<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.check&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(fileName)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Check that OpenBUGS model is sytaxticaly correct<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;deleteRObjs()<br>&nbsp;&nbsp;&nbsp;file &lt;- paste(&quot;'&quot;, as.character(examples), as.character(fileName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.SetFilePath(&quot;, file, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);BugsEmbed.ParseGuard;BugsEmbed.Parse&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Load data for OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.data&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(fileName)<br>{<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Load data for OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;file &lt;- paste(&quot;'&quot;, as.character(examples), as.character(fileName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.SetFilePath(&quot;, file, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);BugsEmbed.LoadDataGuard;BugsEmbed.LoadData&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Compile OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.compile&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(numChains = 1)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Compile OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.CompileGuard&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&quot;;BugsEmbed.Compile(&quot;, as.character(numChains), &quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(1)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(numChains)<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>&nbsp;&nbsp;&nbsp;createRObjs()<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get numChains field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;get.num.chains&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get numChains field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command&lt;- paste(&quot;BugsInterface.numChains&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get chain field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;get.chain&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get chain field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command&lt;- paste(&quot;BugsEmbed.chain&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Load initial values for OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.inits&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(fileName, chainNum = get.chain())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Load initial values for OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;file &lt;- paste(&quot;'&quot;, as.character(examples), as.character(fileName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.SetFilePath(&quot;, file, <br>&nbsp;&nbsp;&nbsp;&quot;); BugsEmbed.LoadInitsGuard; BugsEmbed.chain := &quot;,<br>&nbsp;&nbsp;&nbsp;as.character(chainNum), &quot;; BugsEmbed.LoadInits&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Generate initial values for OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.gen.inits&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Generate initial values for OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.GenerateInitsGuard;&quot;, &quot;BugsEmbed.GenerateInits&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;MCMC updates<br>#<br>############################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Get iteration field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.iteration&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get iteration field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.iteration&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Get endOfAdapting field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.adaptivePhase&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br>#&nbsp;&nbsp;&nbsp;Get endOfAdapting field<br>{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsInterface.endOfAdapting&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;(as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]) -1<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Update the each chain in OpenBUGS model numUpdates * thin times<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.update&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(numUpdates, thin = 1, overRelax = FALSE)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Update the each chain in OpenBUGS model numUpdates * thin time<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;intOverRelax &lt;- 0;<br>&nbsp;&nbsp;&nbsp;if(overRelax) intOverRelax &lt;- 1<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.UpdateGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&quot;;BugsEmbed.thin := &quot;, as.character(as.integer(thin)),<br>&nbsp;&nbsp;&nbsp;&quot;;BugsEmbed.overRelax := &quot;, as.character(as.integer(intOverRelax)),<br>&nbsp;&nbsp;&nbsp;&quot;;BugsEmbed.Update(&quot;,as.character(as.integer(numUpdates)),&quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Saves the sate of each chain in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.save.state&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(stem)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Update the each chain in OpenBUGS model numUpdates * thin time<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;fileStem &lt;- paste(&quot;'&quot;, as.character(stem), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.UpdateGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&quot;;BugsEmbed.WriteChains(&quot;, fileStem, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>###############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Manipulate seed of random number generator.<br>#<br>################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Set the seed of random number generator<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.set.seed&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(newSeed)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the seed of random number generator<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.newSeed := &quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.character(as.integer(newSeed)))<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsEmbed.SetSeedGuard; BugsEmbed.SetSeed&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the seed of random number generator<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.get.seed&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the seed of random number generator<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsEmbed.GetSeed&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;BugsEmbed.newSeed&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Set the precision to which results are displayed<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.precision&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(prec)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the precision to which results are displayed<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsDialog.displayDialog.precision := &quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.character(as.integer(prec)))<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Set properties of updater<br>#<br>#################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Sets the adaptive phase<br>#&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.setAP&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(factoryName, adaptivePhase)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the length of adaptive phase<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;name &lt;- paste(&quot;'&quot;, as.character(factoryName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;UpdaterMethods.SetFactory(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;) ;UpdaterMethods.AdaptivePhaseGuard;&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UpdaterMethods.SetAdaptivePhase(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.character(adaptivePhase),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Sets the number of iterations<br>#&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.setIts&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(factoryName, iterations)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the length of adaptive phase<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;name &lt;- paste(&quot;'&quot;, as.character(factoryName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;UpdaterMethods.SetFactory(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;) ;UpdaterMethods.IterationsGuard;&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UpdaterMethods.SetIterations(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.character(iterations),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>}<br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Sets over relaxation<br>#&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;model.setOR&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(factoryName, overRelaxation)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the length of adaptive phase<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;name &lt;- paste(&quot;'&quot;, as.character(factoryName), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;UpdaterMethods.SetFactory(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;) ;UpdaterMethods.OverRelaxationGuard;&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UpdaterMethods.SetOverRelaxation(&quot;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.character(overRelaxation),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>}<br></font><font face="Arial" color="#008040" size="3"><br>############################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Sample monitors<br>#<br>############################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Set the beg field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set.beg&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(begIt)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the beg field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.beg := &quot;, as.character(as.integer(begIt)));<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Set the end field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set.end&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(endIt)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the end field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.end := &quot;, as.character(as.integer(endIt)));<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Set the firstChain field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set.firstChain&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(first)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the firstChain field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.firstChain := &quot;, as.character(as.integer(first)));<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Set the lastChain field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set.lastChain&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(last)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the lastChain field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.lastChain := &quot;, as.character(as.integer(last)));<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Set the thin field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set.thin&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(thin)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set the thin field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.thin := &quot;, as.character(as.integer(thin)));<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the beg field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.get.beg&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the beg field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.beg&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the end field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.get.end&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the end field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.end&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the firstChain field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.get.firstChain&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the firstChain field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.firstChain&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the lastChain field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.get.lastChain&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the lastChain field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.lastChain&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get the thin field<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.get.thin&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get the thin field<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.thin&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1)))[3]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Set a sample monitor<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.set&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set a sample monitor<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);SamplesEmbed.SetGuard;SamplesEmbed.Set&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Clear a sample monitor<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.clear&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Clear a sample monitor<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);SamplesEmbed.HistoryGuard;SamplesEmbed.Clear&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;List all sample monitors corresponding to node<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.monitors&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;List all sample monitors corresponding to node<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, <br>&nbsp;&nbsp;&nbsp;&quot;);SamplesEmbed.StatsGuard;SamplesEmbed.Labels&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;lines &lt;- readLines(buffer)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(lines)<br>&nbsp;&nbsp;&nbsp;if (len == 1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (lines == &quot;command is not allowed (greyed out)&quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scan(buffer, what = &quot;character&quot;, quiet = TRUE)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;scan(buffer, what = &quot;character&quot;, quiet = TRUE)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Size of stored sample of single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.size&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Size of stored sample of single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get stored sample for single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.sample&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get stored sample for single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;x &lt;- real(sampleSize)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.Sample&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;RealArray&quot;, as.character(command), as.integer(len), x, as.integer(sampleSize), integer(1))[3][[1]]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot auto correlation function for single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;plot.autoC&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot auto correlation function for single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;x &lt;- real(sampleSize)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.Sample&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sample &lt;- .C(&quot;RealArray&quot;, as.character(command), as.integer(len), x,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(sampleSize), integer(1))[3][[1]]<br>&nbsp;&nbsp;&nbsp;colour &lt;- c(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;black&quot;)<br>&nbsp;&nbsp;&nbsp;chain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;if (sd(sample) &gt; 1.0E-10)<br>&nbsp;&nbsp;&nbsp;acf(sample, col = colour[chain], main = nodeName, lwd = 5, demean = TRUE)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br># Calculate the bgr statistic at iteration<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;bgr.point&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, iteration)<br></font><font face="Arial" color="#008040" size="3"># Calculate the bgr statistic at iteration<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;samples.set.end(as.integer(iteration))<br>&nbsp;&nbsp;&nbsp;numChains &lt;- get.num.chains()<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;x &lt;- real(sampleSize)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.Sample&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sample &lt;- .C(&quot;RealArray&quot;, as.character(command), as.integer(len), x,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(sampleSize), integer(1))[3][[1]]<br>&nbsp;&nbsp;&nbsp;lenChain &lt;- sampleSize %/% numChains<br>&nbsp;&nbsp;&nbsp;dq &lt;- quantile(sample, c(0.1, 0.9), names = FALSE)<br>&nbsp;&nbsp;&nbsp;d.delta &lt;- dq[2] - dq[1]<br>&nbsp;&nbsp;&nbsp;n.delta &lt;- 0.0<br>&nbsp;&nbsp;&nbsp;for (i in 1:numChains) {<br>&nbsp;&nbsp;&nbsp;nq &lt;- quantile(sample[((i - 1) * lenChain + 1) : (i * lenChain)], c(0.1, 0.9), names = FALSE)<br>&nbsp;&nbsp;&nbsp;n.delta &lt;- n.delta + nq[2] - nq[1]<br>&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;n.delta &lt;- n.delta / numChains<br>&nbsp;&nbsp;&nbsp;bgr.stat &lt;- d.delta / n.delta<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;c(iteration, n.delta, d.delta, bgr.stat)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br># Calculate grid of points at which to evaluate bgr statistic<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;bgr.grid&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3"># Calculate grid of points at which to evaluate bgr statistic<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;) END&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SampleSize&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;beg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;end &lt;- min(c(samples.get.end(), model.iteration()))<br>&nbsp;&nbsp;&nbsp;numChains &lt;- samples.get.lastChain() - samples.get.firstChain() + 1<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- sampleSize %/% numChains<br>&nbsp;&nbsp;&nbsp;beg &lt;- end - (sampleSize - 1) <br>&nbsp;&nbsp;&nbsp;bins &lt;- 50<br>&nbsp;&nbsp;&nbsp;delta &lt;- sampleSize %/% bins<br>&nbsp;&nbsp;&nbsp;grid&lt;- ((1 : (bins - 1)) * delta) + beg<br>&nbsp;&nbsp;&nbsp;grid &lt;- c(grid, end)<br>&nbsp;&nbsp;&nbsp;grid<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot bgr diagnostic for single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;plot.bgr&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot bgr diagnostic for single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- deparse(substitute(node))<br>&nbsp;&nbsp;&nbsp;grid &lt;- bgr.grid(nodeName)<br>&nbsp;&nbsp;&nbsp;bgr &lt;- sapply(grid, bgr.point, node = nodeName)<br>&nbsp;&nbsp;&nbsp;yRange &lt;- range(bgr[4,])<br>&nbsp;&nbsp;&nbsp;yRange &lt;- c(0, max(c(1.2, yRange[2])))<br>&nbsp;&nbsp;&nbsp;nRange &lt;- range(bgr[2,])<br>&nbsp;&nbsp;&nbsp;nRange &lt;- c(min(c(0, nRange[1])), nRange[2])<br>&nbsp;&nbsp;&nbsp;nDelta &lt;- nRange[2] - nRange[1]<br>&nbsp;&nbsp;&nbsp;dRange &lt;- range(bgr[3,])<br>&nbsp;&nbsp;&nbsp;dRange &lt;- c(min(c(0, dRange[1])), dRange[2])<br>&nbsp;&nbsp;&nbsp;dDelta &lt;- dRange[2] - dRange[1]<br>&nbsp;&nbsp;&nbsp;max &lt;- 2 * max(c(nDelta, dDelta))<br>&nbsp;&nbsp;&nbsp;bgr[2,] &lt;- bgr[2,] / max<br>&nbsp;&nbsp;&nbsp;bgr[3,] &lt;- bgr[3,] / max<br>&nbsp;&nbsp;&nbsp;plot(grid, bgr[4,], ylim = yRange, type = &quot;n&quot;, main = nodeName, xlab = &quot;iteration&quot;, ylab = &quot;bgr&quot;)<br>&nbsp;&nbsp;&nbsp;lines(grid, bgr[4,], col = &quot;red&quot;)<br>&nbsp;&nbsp;&nbsp;lines(grid, bgr[2,], col = &quot;blue&quot;)<br>&nbsp;&nbsp;&nbsp;lines(grid, bgr[3,], col = &quot;green&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot history for single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;plot.history&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot history for single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;x &lt;- real(sampleSize)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.Sample&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sample &lt;- .C(&quot;RealArray&quot;, as.character(command), as.integer(len), x,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(sampleSize), integer(1))[3][[1]]<br>&nbsp;&nbsp;&nbsp;end &lt;- min(c(model.iteration(), samples.get.end()))<br>&nbsp;&nbsp;&nbsp;thin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;numChains &lt;- samples.get.lastChain() - samples.get.firstChain() + 1<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- sampleSize %/% numChains<br>&nbsp;&nbsp;&nbsp;beg &lt;- end - (sampleSize - 1) * thin<br>&nbsp;&nbsp;&nbsp;beg &lt;- beg %/% thin<br>&nbsp;&nbsp;&nbsp;end &lt;- end %/% thin<br>&nbsp;&nbsp;&nbsp;x &lt;- c(beg:end) * thin<br>&nbsp;&nbsp;&nbsp;y &lt;- sample[1:sampleSize]<br>&nbsp;&nbsp;&nbsp;plot(x, y, ylim = range(sample), type = &quot;n&quot;, main = nodeName, xlab = &quot;iteration&quot;, ylab = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;colour &lt;- c(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;black&quot;)<br>&nbsp;&nbsp;&nbsp;for (chain in 1:numChains){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y &lt;- sample[(1 + (chain - 1) * sampleSize):(sampleSize * chain)]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines(x, y, col = colour[chain])<br>&nbsp;&nbsp;&nbsp;}<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot posterior density for single component of OpenBUGS name<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;plot.density&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot posterior density for single component of OpenBUGS name<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, &quot;)&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.SampleSize&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sampleSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), integer(1))[3])<br>&nbsp;&nbsp;&nbsp;x &lt;- real(sampleSize)<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;SamplesEmbed.Sample&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;sample &lt;- .C(&quot;RealArray&quot;, as.character(command), as.integer(len), x,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(sampleSize), integer(1))[3][[1]]<br>&nbsp;&nbsp;&nbsp;absSample &lt;- abs(sample)<br>&nbsp;&nbsp;&nbsp;intSample &lt;- as.integer(absSample + 1.0E-10)<br>&nbsp;&nbsp;&nbsp;zero &lt;- absSample - intSample<br>&nbsp;&nbsp;&nbsp;intSample &lt;- as.integer(sample)<br>&nbsp;&nbsp;&nbsp;if (sum(zero) &gt; 0){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d &lt;- density(sample, adjust = 1.25)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plot(d$x, d$y, type = &quot;l&quot;, main = nodeName, xlab = &quot;&quot; , ylab = &quot;&quot;, col = &quot;red&quot;)}<br>&nbsp;&nbsp;&nbsp;else{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;histogram &lt;- table(intSample) / sampleSize<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xRange &lt;- range(intSample)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xLim &lt;- c(xRange[1] - 0.5, xRange[2] + 0.5)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plot(histogram, type = &quot;h&quot;, xlim = xLim, ylim = c(0, 1), main = nodeName, xlab = &quot;&quot; , ylab = &quot;&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;col = &quot;red&quot;, lwd = 5)<br>&nbsp;&nbsp;&nbsp;}<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot auto correlation function<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.autoC&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, chain, beg = samples.get.beg(), end = samples.get.end(),<br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot auto correlation function<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;beg &lt;- max(beg, model.adaptivePhase())<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;chain &lt;- max(c(1, chain))<br>&nbsp;&nbsp;&nbsp;chain &lt;- min(c(get.num.chains(), chain))<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(chain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(chain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- deparse(substitute(node))<br>&nbsp;&nbsp;&nbsp;mons &lt;- samples.monitors(nodeName)<br>&nbsp;&nbsp;&nbsp;par(mfrow = c(3, 2), ask = TRUE, ann = TRUE)<br>&nbsp;&nbsp;&nbsp;junk &lt;- sapply(mons, plot.autoC)<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot bgr statistic<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.bgr&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, beg = samples.get.beg(), end = samples.get.end(), <br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot bgr statistic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;beg &lt;- max(beg, model.adaptivePhase())<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- deparse(substitute(node))<br>&nbsp;&nbsp;&nbsp;mons &lt;- samples.monitors(nodeName)<br>&nbsp;&nbsp;&nbsp;par(mfrow = c(3, 2), ask = TRUE, ann = TRUE)<br>&nbsp;&nbsp;&nbsp;junk &lt;- sapply(mons, plot.bgr)<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Plot history<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.history&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, beg = samples.get.beg(), end = samples.get.end(),<br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Plot history&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- deparse(substitute(node))<br>&nbsp;&nbsp;&nbsp;mons &lt;- samples.monitors(nodeName)<br>&nbsp;&nbsp;&nbsp;par(mfrow = c(3, 1), ask = TRUE, ann = TRUE)<br>&nbsp;&nbsp;&nbsp;junk &lt;- sapply(mons, plot.history)<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br># Plot posterior density<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.density&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, beg = samples.get.beg(), end = samples.get.end(), <br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3"># Plot posterior density&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;beg &lt;- max(beg, model.adaptivePhase())<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- as.character(node)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- deparse(substitute(node))<br>&nbsp;&nbsp;&nbsp;mons &lt;- samples.monitors(nodeName)<br>&nbsp;&nbsp;&nbsp;par(mfrow = c(3, 2), ask = TRUE, ann = TRUE)<br>&nbsp;&nbsp;&nbsp;junk &lt;- sapply(mons, plot.density)<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>}<br><br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Calculate statistics for monitored node<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.stats&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, beg = samples.get.beg(), end = samples.get.end(), <br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Calculate statistics for monitored node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, <br>&nbsp;&nbsp;&nbsp;&quot;);SamplesEmbed.StatsGuard&quot;, &quot;SamplesEmbed.Stats&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(readLines(buffer))<br>&nbsp;&nbsp;&nbsp;if (len &gt; 1)<br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Write out CODA files<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.coda&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node, stem, beg = samples.get.beg(), end = samples.get.end(), <br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Write out CODA files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;beg &lt;- max(beg, model.adaptivePhase())<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;fileStem &lt;- paste(&quot;'&quot;, as.character(stem), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SamplesEmbed.SetVariable(&quot;, nodeName, <br>&nbsp;&nbsp;&nbsp;&quot;);SamplesEmbed.StatsGuard&quot;, &quot;SamplesEmbed.CODA(&quot;,<br>&nbsp;&nbsp;&nbsp;fileStem, &quot;)&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Correlation matrix of two quantities in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;samples.correl&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node0, node1,beg = samples.get.beg(), end = samples.get.end(), <br>firstChain = samples.get.firstChain(), lastChain = samples.get.lastChain(), <br>thin = samples.get.thin())<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Correlation matrix of two quantities in OpenBUGS model<br><br><br># is brocken not getting beg end etc set in CorrelEmbed<br><br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;oldBeg &lt;- samples.get.beg()<br>&nbsp;&nbsp;&nbsp;oldEnd &lt;- samples.get.end()<br>&nbsp;&nbsp;&nbsp;oldFirstChain &lt;- samples.get.firstChain()<br>&nbsp;&nbsp;&nbsp;oldLastChain &lt;- samples.get.lastChain()<br>&nbsp;&nbsp;&nbsp;oldThin &lt;- samples.get.thin()<br>&nbsp;&nbsp;&nbsp;samples.set.beg(beg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(end)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(firstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(lastChain)<br>&nbsp;&nbsp;&nbsp;thin &lt;- max(c(thin, 1))<br>&nbsp;&nbsp;&nbsp;samples.set.thin(thin)<br>&nbsp;&nbsp;&nbsp;if (is.character(node0)) nodeName0 &lt;- paste(&quot;'&quot;, as.character(node0), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName0 &lt;- paste(&quot;'&quot;, deparse(substitute(node0)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;if (is.character(node1)) nodeName1 &lt;- paste(&quot;'&quot;, as.character(node1), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName1 &lt;- paste(&quot;'&quot;, deparse(substitute(node1)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;CorrelEmbed.SetVariable0(&quot;, nodeName0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);CorrelEmbed.SetVariable1(&quot;, nodeName1, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;);CorrelEmbed.Guard&quot;, &quot;;CorrelEmbed.PrintMatrix&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;samples.set.beg(oldBeg)<br>&nbsp;&nbsp;&nbsp;samples.set.end(oldEnd)<br>&nbsp;&nbsp;&nbsp;samples.set.firstChain(oldFirstChain)<br>&nbsp;&nbsp;&nbsp;samples.set.lastChain(oldLastChain)<br>&nbsp;&nbsp;&nbsp;samples.set.thin(oldThin)&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(readLines(buffer))<br>&nbsp;&nbsp;&nbsp;if (len &gt; 1)<br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>####################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Summary statistics<br>#<br>####################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Set summary monitor for node in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;summary.set&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set summary monitor for node in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if(is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SummaryEmbed.SetVariable(&quot;, nodeName, &quot;); SummaryEmbed.SetGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;SummaryEmbed.Set&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Clear summary monitor for node in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;summary.clear&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Clear summary monitor for node in WQinBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SummaryEmbed.SetVariable(&quot;, nodeName, &quot;) SummaryEmbed.StatsGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;SummaryEmbed.Clear&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Calculates statistics for summary monitor associated with node in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;summary.stats&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Calculates statistics for summary monitor associated with node in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;SummaryEmbed.SetVariable(&quot;, nodeName, &quot;) SummaryEmbed.StatsGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;SummaryEmbed.Stats&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(readLines(buffer))<br>&nbsp;&nbsp;&nbsp;if (len &gt; 1) <br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Rank monitor<br>#<br>#################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Set a ranks monitor for vector quantity node in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;ranks.set&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set a ranks monitor for vector quantity node in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if(is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;RanksEmbed.SetVariable(&quot;, nodeName, &quot;) RanksEmbed.SetGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;RanksEmbed.Set&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Clears a ranks monitor for vector quantity in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;ranks.clear&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Clears a ranks monitor for vector quantity in OpenBUGS model<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;RanksEmbed.SetVariable(&quot;, nodeName, &quot;) RanksEmbed.StatsGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;RanksEmbed.Clear&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3">#<br>#&nbsp;&nbsp;&nbsp;Calculates ranks statistics for vector valued node in OpenBUGS model<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;ranks.stats&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Calculates ranks statistics for vector valued node in OpenBUGS model</font><font face="Arial" color="#000100" size="3"><br>{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;RanksEmbed.SetVariable(&quot;, nodeName, &quot;) RanksEmbed.StatsGuard&quot;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;RanksEmbed.Stats&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(readLines(buffer))<br>&nbsp;&nbsp;&nbsp;if (len &gt; 1) <br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Deviance information<br>#<br>#################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Set a monitor for dic<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;dic.set&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Set a monitor for dic<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;DevianceEmbed.SetGuard;DevianceEmbed.Set&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Clear monitor for dic<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;dic.clear&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Clear monitor for dic<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;DevianceEmbed.StatsGuard;DevianceEmbed.Clear&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;cat(&quot;&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Calculate dic statistics<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;dic.stats&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function()<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Calculate dic statistics<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;command &lt;- &quot;DevianceEmbed.StatsGuard;DevianceEmbed.Stats&quot;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- length(readLines(buffer))<br>&nbsp;&nbsp;&nbsp;if (len &gt; 1) <br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;cat(readLines(buffer), &quot;\n&quot;)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>##################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Set values and get values of quanties in OpenBUGS model<br>#<br>##################################################################<br><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;current.values&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(nodeLabel)<br></font><font face="Arial" color="#008040" size="3"># Get current value of node<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;nodeLabel &lt;- as.character(nodeLabel)<br>&nbsp;&nbsp;&nbsp;lenLabel &lt;- nchar(nodeLabel)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjects.Set&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CharArray&quot;, as.character(command), as.integer(len), as.character(nodeLabel),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(lenLabel), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjets.Size&quot;);<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;nodeSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), <br>&nbsp;&nbsp;&nbsp;integer(1))[3])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjects.Values&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;values &lt;- real(nodeSize);<br>&nbsp;&nbsp;&nbsp;for (i in 1: nodeSize){ values[i] &lt;- NA }<br>&nbsp;&nbsp;&nbsp;.C(&quot;RealArray&quot;, as.character(command), as.integer(len), values, as.integer(nodeSize),<br>&nbsp;&nbsp;&nbsp;integer(1))[[3]]<br>}<br><br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;set.values&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(nodeLabel, values)<br></font><font face="Arial" color="#008040" size="3"># set value of node<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;nodeLabel &lt;- as.character(nodeLabel)<br>&nbsp;&nbsp;&nbsp;lenLabel &lt;- nchar(nodeLabel)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjects.Set&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CharArray&quot;, as.character(command), as.integer(len), as.character(nodeLabel),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as.integer(lenLabel), integer(1))<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjets.Size&quot;);<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;nodeSize &lt;- as.integer(.C(&quot;Integer&quot;, as.character(command), as.integer(len), integer(1), <br>&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;check length(values) == nodeSize<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsRobjects.SetValues&quot;)&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;.C(&quot;RealArray&quot;, as.character(command), as.integer(len), values, as.integer(nodeSize),<br>&nbsp;&nbsp;&nbsp;integer(1))[[4]]<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#####################################################################<br>#<br>#&nbsp;&nbsp;&nbsp;Get type info about OpenBUGS objects<br>#<br>#####################################################################<br><br>#<br>#&nbsp;&nbsp;&nbsp;Get type of GraphNode objects<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;get.graphObj&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get type of GraphNode objects<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.SetVariable(&quot;, nodeName, &quot;); BugsEmbed.Nodes&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>}<br></font><font face="Arial" color="#008040" size="3"><br>#<br>#&nbsp;&nbsp;&nbsp;Get type of UpdaterUpdaters objects<br>#<br></font><font face="Arial" color="#AC0000" size="3"><strong>&quot;get.updaterObj&quot;</strong></font><font face="Arial" color="#000100" size="3"> &lt;- function(node)<br></font><font face="Arial" color="#008040" size="3">#&nbsp;&nbsp;&nbsp;Get type of UpdaterUpdaters objects<br></font><font face="Arial" color="#000100" size="3">{<br>&nbsp;&nbsp;&nbsp;if (is.character(node)) nodeName &lt;- paste(&quot;'&quot;, as.character(node), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;else nodeName &lt;- paste(&quot;'&quot;, deparse(substitute(node)), &quot;'&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;command &lt;- paste(&quot;BugsEmbed.SetVariable(&quot;, nodeName, &quot;); BugsEmbed.Methods&quot;)<br>&nbsp;&nbsp;&nbsp;len &lt;- nchar(command)<br>&nbsp;&nbsp;&nbsp;.C(&quot;CmdInterpreter&quot;, as.character(command), as.integer(len), integer(1))<br>&nbsp;&nbsp;&nbsp;buffer &lt;- paste(tempDir, &quot;/buffer.txt&quot;, sep = &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;read.table(buffer)<br>}<br><br></font></p></body></html>