<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Tips and Troubleshooting</title></head><body><p><font face="Arial" color="#000100" size="2"><img src="tips and troubleshooting0.bmp" alt="[tips and troubleshooting0]"></font><font face="Arial" color="#000100" size="6"><strong>&nbsp;&nbsp;&nbsp;Tips and Troubleshooting</strong></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#0000FF" size="2"><br></font><font face="Arial" color="#000100" size="2"><a id="Contents"></font><font face="Arial" color="#000100" size="5"><strong>Contents</strong></font><font face="Arial" color="#000100" size="2"></a><br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#RestrictionsWhenModelling"></font><font face="Arial" color="#0000FF" size="4"><u>Restrictions&nbsp;when&nbsp;modelling</u></font><font face="Arial" color="#0000FF" size="4"></a><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#SomeErrorMessages"></font><font face="Arial" color="#0000FF" size="4"><u>Some&nbsp;error&nbsp;messages</u></font><font face="Arial" color="#0000FF" size="4"></a><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#SomeTrapMessages"></font><font face="Arial" color="#0000FF" size="4"><u>Some&nbsp;Trap&nbsp;messages</u></font><font face="Arial" color="#0000FF" size="4"></a><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#TheProgramHangs"></font><font face="Arial" color="#0000FF" size="4"><u>The&nbsp;program&nbsp;hangs</u></font><font face="Arial" color="#0000FF" size="4"></a><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#SpeedingUpSampling"></font><font face="Arial" color="#0000FF" size="4"><u>Speeding&nbsp;up&nbsp;sampling</u></font><font face="Arial" color="#0000FF" size="4"></a><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="4"><a href="#ImprovingConvergence"></font><font face="Arial" color="#0000FF" size="4"><u>Improving&nbsp;convergence</u></font><font face="Arial" color="#0000FF" size="4"></a><br>&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="2"><u><br></u></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">This section covers a range of problems that might arise:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">1) restrictions in setting up the model;<br>2) error messages generated when setting up the model or when sampling;<br>3) Traps: these corresponds to an error which has not been picked up by </font><font face="Arial" color="#000100" size="3"><em>WinBUGS</em></font><font face="Arial" color="#000100" size="3">. It is difficult to interpret the Trap message!<br>4) the program just hanging;<br>5) slow sampling;<br>6) lack of convergence.</font><font face="Arial" color="#000100" size="2"><br><br><a id="RestrictionsWhenModelling"></font><font face="Arial" color="#000100" size="5"><strong>Restrictions when modelling</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">Restrictions have been stated throughout this manual. A summary list is as follows:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">a) Each stochastic and logical node must appear once and only once on the left-hand-side of an expression. The only exception is when carrying out a data transformation (see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Model Specification.html#DataTransformations"></font><font face="Arial" color="#0000FF" size="3"><u>Data&nbsp;transformations</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3">). </font><font face="Arial" color="#000000" size="3">This means, for example, that it is generally not possible to give a distribution to a quantity that is specified as a logical function of an unknown parameter.</font><font face="Arial" color="#000000" size="3"><strong><br></strong></font><font face="Arial" color="#000100" size="3">b) Truncated sampling distributions cannot be handled using the I(.,.) construct - see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Model Specification.html#CensoringAndTruncation"></font><font face="Arial" color="#0000FF" size="3"><u>Censoring&nbsp;and&nbsp;truncation</u></font><font face="Arial" color="#0000FF" size="3"></a>.</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000000" size="3">c) Multivariate distributions: Wishart distributions may only be used as conjugate priors and must have known parameters; multivariate normal and Student-t distributions can be used anywhere in the graph (i.e. as prior or likelihood) and there are no restrictions regarding their parameters. See </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Model Specification.html#ConstraintsOnUsingCertainDistributions"></font><font face="Arial" color="#0000FF" size="3"><u>Constraints&nbsp;on&nbsp;using&nbsp;certain&nbsp;distributions</u></font><font face="Arial" color="#0000FF" size="3"></a>.</font><font face="Arial" color="#000000" size="3"><br>d) Logical nodes cannot be given data or initial values. This means, for example, that it is not possible to </font><font face="Arial" color="#000100" size="3">model observed data that is the sum of two random variables. (See </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Model Specification.html#LogicalNodes"></font><font face="Arial" color="#0000FF" size="3"><u>Logical&nbsp;nodes</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3">.)</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000000" size="3">e) </font><font face="Arial" color="#000100" size="3">Poisson priors can only be specified for the (unknown) order (n) of a </font><font face="Arial" color="#000100" size="3"><em>single</em></font><font face="Arial" color="#000100" size="3"> binomial observation. In this case, the sampling method for a 'shifted Poisson' distribution will be used (see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Introduction.html#IntroductionMCMCMethods"></font><font face="Arial" color="#0000FF" size="3"><u>MCMC&nbsp;methods</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3">). If more than one binomial response is assumed to share the same order parameter, then the algorithm for a shifted Poisson cannot be used to update the order parameter and WinBUGS will return the error message &quot;Unable to choose update method for n&quot;. A suitably constrained continuous prior may be used for the order parameter, provided that it is used in conjunction with the round(.) function to ensure integer values (see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Tricks.html#ModellingUnknownDenominators"></font><font face="Arial" color="#0000FF" size="3"><u>here</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3"> for an example of using the 'round' function to this end).</font><font face="Arial" color="#000100" size="2"><br><br><a id="SomeErrorMessages"></font><font face="Arial" color="#000100" size="5"><strong>Some error messages</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="2"><strong></strong></font><font face="Arial" color="#000100" size="3">a) </font><font face="Arial" color="#000100" size="3"><strong>'expected variable name' </strong></font><font face="Arial" color="#000100" size="3">indicates an inappropriate variable name.<br>b) </font><font face="Arial" color="#000100" size="3"><strong>'linear predictor in probit regression too large' </strong></font><font face="Arial" color="#000100" size="3">indicates numerical overflow. See possible solutions below for Trap 'undefined real result'.<br></font><font face="Arial" color="#000000" size="3">c) </font><font face="Arial" color="#000000" size="3"><strong>'logical expression too complex'</strong></font><font face="Arial" color="#000000" size="3"> - a logical node is defined in terms of too many parameters/constants or too many operators: try introducing further logical nodes to represent parts of the overall calculation; for example, a1 + a2 + a3 + b1 + b2 + b3 could be written as A + B where A and B are the simpler logical expressions a1 + a2 + a3 and b1 + b2 + b3, respectively. Note that linear predictors with many terms should be formulated by 'vectorizing' parameters and covariates and by then using the inprod(.,.) function (see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Model Specification.html#LogicalNodes"></font><font face="Arial" color="#0000FF" size="3"><u>Logical&nbsp;nodes</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000000" size="3">).<br></font><font face="Arial" color="#000100" size="3">d) </font><font face="Arial" color="#000100" size="3"><strong>'invalid or unexpected token scanned' - </strong></font><font face="Arial" color="#000100" size="3">check that the </font><font face="Arial" color="#000100" size="3"><em>value</em></font><font face="Arial" color="#000100" size="3"> field of a logical node in a Doodle has been completed.<br>e) </font><font face="Arial" color="#000100" size="3"><strong>'unable to choose update method' </strong></font><font face="Arial" color="#000100" size="3">indicates that a restriction in the program has been violated - see </font><font face="Arial" color="#0000FF" size="3"><a href="#RestrictionsWhenModelling"></font><font face="Arial" color="#0000FF" size="3"><u>Restrictions&nbsp;when&nbsp;modelling</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3"> above.<br>f) </font><font face="Arial" color="#000100" size="3"><strong>'undefined variable' </strong></font><font face="Arial" color="#000100" size="3">- variables in a data file must be defined in a model (just put them in as constants or with vague priors). If a logical node is reported </font><font face="Arial" color="#000100" size="3"><em>undefined</em></font><font face="Arial" color="#000100" size="3">, the problem may be with a node on the 'right hand side'.</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000000" size="3">g) </font><font face="Arial" color="#000000" size="3"><strong>'index out of range'</strong></font><font face="Arial" color="#000000" size="3"> - usually indicates that a loop-index goes beyond the size of a vector (or matrix dimension); sometimes, however, appears if the # has been omitted from the beginning of a comment line.</font><font face="Arial" color="#000000" size="2"><br><br></font><font face="Arial" color="#000100" size="2"><a id="SomeTrapMessages"></font><font face="Arial" color="#000100" size="5"><strong>Some Trap messages</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="2"><strong></strong></font><font face="Arial" color="#000100" size="3">a) </font><font face="Arial" color="#000100" size="3"><strong>'undefined real result' </strong></font><font face="Arial" color="#000100" size="3">indicates numerical overflow. Possible reasons include:<br>- initial values generated from a 'vague' prior distribution may be numerically extreme - specify appropriate initial values;<br>- numerically impossible values such as log of a non-positive number - check, for example, that no zero expectations have been given when Poisson modelling;<br>- numerical difficulties in sampling. Possible solutions include:<br>- better initial values;<br>- more informative priors - uniform priors might still be used but with their range restricted to plausible values;<br>- better parameterisation to improve orthogonality;<br>- standardisation of covariates to have mean 0 and standard deviation 1.<br>- can happen if all initial values are equal.<br><br>Probit models are particularly susceptible to this problem, i.e. generating undefined real results. If a probit is a stochastic node, it may help to put reasonable bounds on its distribution, e.g.<br><br>&nbsp;&nbsp;&nbsp;probit(p[i]) &lt;- delta[i]<br>&nbsp;&nbsp;&nbsp;delta[i] ~ dnorm(mu[i], tau)I(-5, 5)<br><br>This trap can sometimes be escaped from by simply clicking on the update button. The equivalent construction<br><br>&nbsp;&nbsp;&nbsp;p[i] &lt;- phi(delta[i])<br><br>may be more forgiving.<br><br>b) </font><font face="Arial" color="#000100" size="3"><strong>'index array out of range' - </strong></font><font face="Arial" color="#000100" size="3">possible reasons include:<br>- attempting to assign values beyond the declared length of an array;<br>- if a logical expression is too long to evaluate - break it down into smaller components.<br><br>c) </font><font face="Arial" color="#000100" size="3"><strong>'stack overflow' </strong></font><font face="Arial" color="#000100" size="3">can occur if there is a recursive definition of a logical node.<br><br>d) </font><font face="Arial" color="#000100" size="3"><strong>'NIL dereference (read)' </strong></font><font face="Arial" color="#000100" size="3">can occur at compilation in some circumstances when an inappropriate transformation is made, for example an array into a scalar.<br><br>e) Trap messages referring to </font><font face="Arial" color="#000100" size="3"><strong>'DFreeARS' </strong></font><font face="Arial" color="#000100" size="3">indicate numerical problems with the derivative-free adaptive rejection algorithm used for log-concave distributions. One possibility is to change to &quot;Slice&quot; sampling - see </font><font face="Arial" color="#0000FF" size="3"><a href="../Docu/Changing MCMC Defaults.html#DefaultsForSamplingMethods"></font><font face="Arial" color="#0000FF" size="3"><u>here</u></font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3"> for details.<br></font><font face="Arial" color="#000100" size="2"><strong><br></strong></font><font face="Arial" color="#000100" size="2"><a id="TheProgramHangs"></font><font face="Arial" color="#000100" size="5"><strong>The program hangs</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">This could be due to:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">a) a problem that seems to happen with NT - rebooting is a crude way out;<br>b) interference with other programs running - try to run WinBUGS on its own;<br>c) a particularly ill-posed model - try the approaches listed above under Trap messages.<br></font><font face="Arial" color="#000100" size="2"><br><a id="SpeedingUpSampling"></font><font face="Arial" color="#000100" size="5"><strong>Speeding up sampling</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">The key is to reduce function evaluations by expressing the model in as concise a form as possible. For example, take advantage of the functions provided and use nested indexing wherever possible. Look at the packaged examples and others provided on users' web sites.<br></font><font face="Arial" color="#000100" size="2"><br><a id="ImprovingConvergence"></font><font face="Arial" color="#000100" size="5"><strong>Improving convergence</strong></font><font face="Arial" color="#000100" size="2"></a> </font><font face="Arial" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">Possible solutions include:</font><font face="Arial" color="#000100" size="2"><br><br></font><font face="Arial" color="#000100" size="3">a) better parameterisation to improve orthogonality of joint posterior;<br>b) standardisation of covariates to have mean 0 and standard deviation 1;<br>c) use of ordered over-relaxation.<br></font><font face="Arial" color="#000100" size="3"><strong><br></strong></font><font face="Arial" color="#000100" size="3">For other problems, try the FAQ pages of the web site and the Classic BUGS manual. Then try mailing us on bugs@mrc-bsu.cam.ac.uk.<br><br>Please try and keep the discussion list for modelling issues and problems other than</font><font face="Arial" color="#000100" size="3"><strong> </strong></font><font face="Arial" color="#000100" size="3"><em>my program won't run!</em></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="2"><strong><br></strong></font></p></body></html>