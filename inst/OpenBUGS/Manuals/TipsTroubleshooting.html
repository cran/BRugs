<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>TipsTroubleshooting</title></head><body><p><font face="Arial" color="#000100" size="2"><img src="tipstroubleshooting0.bmp" alt="[tipstroubleshooting0]"></font><font face="Arial" color="#000100" size="6"><strong>&nbsp;&nbsp;&nbsp;</strong></font><font face="Courier New" color="#000100" size="6">Tips and Troubleshooting</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#0000FF" size="2"><br></font><font face="Arial" color="#000100" size="2"><a id="Contents"></font><font face="Courier New" color="#000100" size="5">Contents</font><font face="Arial" color="#000100" size="2"></a><br></font><font face="Courier New" color="#0000FF" size="3"><br>&nbsp;&nbsp;&nbsp;<a href="#RestrictionsWhenModelling">Restrictions&nbsp;when&nbsp;modelling</a><br>&nbsp;&nbsp;&nbsp;<a href="#SomeErrorMessages">Some&nbsp;error&nbsp;messages</a><br>&nbsp;&nbsp;&nbsp;<a href="#TrapMessages">Trap&nbsp;windows</a><br>&nbsp;&nbsp;&nbsp;<a href="#TheProgramHangs">The&nbsp;program&nbsp;hangs</a><br>&nbsp;&nbsp;&nbsp;<a href="#SpeedingUpSampling">Speeding&nbsp;up&nbsp;sampling</a><br>&nbsp;&nbsp;&nbsp;<a href="#ImprovingConvergence">Improving&nbsp;convergence</a><br></font><font face="Arial" color="#000100" size="2"><br><br><a id="RestrictionsWhenModelling"></font><font face="Courier New" color="#000100" size="5">Restrictions when modelling</font><font face="Arial" color="#000100" size="2"></a> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">Restrictions have been stated throughout this manual. A summary list is as follows:<br></font><font face="Arial" color="#000100" size="2"><br><br></font><font face="Arial" color="#000100" size="3">a) Each stochastic and logical node must appear once and only once on the left-hand-side of an expression. The only exception is when carrying out a data transformation (see</font><font face="Courier New" color="#0000FF" size="3"> <a href="../Manuals/ModelSpecification.html#DataTransformations">Data&nbsp;transformations</a></font><font face="Arial" color="#000100" size="3">). </font><font face="Arial" color="#000000" size="3">This means, for example, that it is generally not possible to give a distribution to a quantity that is specified as a logical function of an unknown parameter.<br></font><font face="Arial" color="#000000" size="3"><strong><br></strong></font><font face="Arial" color="#000100" size="3">b) Truncated sampling distributions cannot be handled using the C(.,.) construct - see</font><font face="Courier New" color="#0000FF" size="3"> <a href="../Manuals/ModelSpecification.html#TheBUGSLanguageStochasticNodes">BUGS&nbsp;language:&nbsp;stochastic&nbsp;nodes</a>.</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000000" size="3">c) Multivariate distributions: Wishart distributions may only be used as conjugate priors and must have known parameters; multivariate normal and Student-t distributions can be used anywhere in the graph (i.e. as prior or likelihood) and there are no restrictions regarding their parameters. See </font><font face="Courier New" color="#0000FF" size="3"><a href="../Manuals/ModelSpecification.html#TheBUGSLanguageStochasticNodes">BUGS&nbsp;language:&nbsp;stochastic&nbsp;nodes</font><font face="Arial" color="#0000FF" size="3"></a>.<br></font><font face="Arial" color="#000000" size="3"><br>d) Logical nodes cannot be given data or initial values. This means, for example, that it is not possible to </font><font face="Arial" color="#000100" size="3">model observed data that is the sum of two random variables. (See</font><font face="Courier New" color="#0000FF" size="3"> <a href="../Manuals/ModelSpecification.html#LogicalNodes">Logical&nbsp;nodes</font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000100" size="3">.)<br><br></font><font face="Arial" color="#000100" size="2"><br><br><a id="SomeErrorMessages"></font><font face="Courier New" color="#000100" size="5">Some error messages</font><font face="Arial" color="#000100" size="2"></a> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br><br></font><font face="Arial" color="#000100" size="3">In general OpenBUGS tries to give informative, easily understood error messages when there is a problem with the model specification, the data or initial values, or if problems occur with the sampling algorithms. However sometimes numerical problems occur with the sampling algorithms, when this happens a trap message is produced providing a detailed trace back to where the error occurs. <br><br>When an error occurs in the syntax of the model specification or in the data or initial values the position of the error will be marked by changing the nearest symbol in the relevant window to inverse video, you must make sure the title bar of this window is selected to be able locate the position of the error. Errors can still occur with a model even if it is syntaxically correct. When this happens the error message contains the name of the variable for which the error occurs.<br><br>Some common error messages are:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">a) </font><font face="Arial" color="#000100" size="3"><strong>'expected variable name' </strong></font><font face="Arial" color="#000100" size="3">indicates an inappropriate variable name, for example a variable name in a data set is not a variable name in the model.<br><br>b) </font><font face="Arial" color="#000100" size="3"><strong>'linear predictor in probit regression too large' </strong></font><font face="Arial" color="#000100" size="3">indicates numerical overflow. See possible solutions below for Trap 'undefined real result'.<br><br></font><font face="Arial" color="#000000" size="3">c) </font><font face="Arial" color="#000000" size="3"><strong>'logical expression too complex'</strong></font><font face="Arial" color="#000000" size="3"> - a logical node is defined in terms of too many parameters/constants or too many operators: try introducing further logical nodes to represent parts of the overall calculation; for example, a1 + a2 + a3 + b1 + b2 + b3 could be written as A + B where A and B are the simpler logical expressions a1 + a2 + a3 and b1 + b2 + b3, respectively. Note that linear predictors with many terms should be formulated by 'vectorizing' parameters and covariates and by then using the inprod(.,.) function (see </font><font face="Courier New" color="#0000FF" size="3"><a href="../Manuals/ModelSpecification.html#LogicalNodes">Logical&nbsp;nodes</font><font face="Arial" color="#0000FF" size="3"></a></font><font face="Arial" color="#000000" size="3">).<br><br></font><font face="Arial" color="#000100" size="3">d) </font><font face="Arial" color="#000100" size="3"><strong>'invalid or unexpected token scanned' - </strong></font><font face="Arial" color="#000100" size="3">the parser has encountered an unexpected symbol, for example if using a Doodle check that the </font><font face="Arial" color="#000100" size="3"><em>value</em></font><font face="Arial" color="#000100" size="3"> field of a logical node has been completed.<br><br>e) </font><font face="Arial" color="#000100" size="3"><strong>'unable to choose update method' </strong></font><font face="Arial" color="#000100" size="3">indicates that a restriction in the program has been violated - see </font><font face="Courier New" color="#0000FF" size="3"><a href="#RestrictionsWhenModelling">Restrictions&nbsp;when&nbsp;modelling</a></font><font face="Arial" color="#000100" size="3"> above.<br><br>f) </font><font face="Arial" color="#000100" size="3"><strong>'undefined variable' </strong></font><font face="Arial" color="#000100" size="3">- undefined variables are allowed in the model so long as they are not used on the right hand side of a relation.<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000000" size="3">g) </font><font face="Arial" color="#000000" size="3"><strong>'index out of range'</strong></font><font face="Arial" color="#000000" size="3"> - usually indicates that a loop-index goes beyond the size of a vector (or matrix dimension).</font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#000000" size="3"><br>In rare cases </font><font face="Arial" color="#000000" size="3"><em>OpenBUGS</em></font><font face="Arial" color="#000000" size="3"> is unable to find a suitable sampling algorithm for a node in the model. The error message </font><font face="Arial" color="#000000" size="3"><strong>'Unable to choose update method for node x' </strong></font><font face="Arial" color="#000000" size="3">will be displayed where x is the node for which </font><font face="Arial" color="#000000" size="3"><em>OpenBUGS</em></font><font face="Arial" color="#000000" size="3"> can not find an update method.<br></font><font face="Arial" color="#000000" size="2"><br></font><font face="Arial" color="#000100" size="2"><a id="TrapMessages"></font><font face="Courier New" color="#000100" size="5">Trap windows</font><font face="Arial" color="#000000" size="3"></a></font><font face="Arial" color="#000100" size="2"> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br><br></font><font face="Arial" color="#000100" size="3">Trap windows occur when a problem with the BUGS software is detected by the run time system. The run time system is a small piece of software that watches the main program (OpenBUGS) and reports if some illegal action occurs. The first line of the trap windows gives a description of the type of illegal action detected by the run time system. Note that a trap window is different to an error message. It can be thought of as an error in the use of the OpenBUGS software that should have produced an error message but for which the error handling code does not exist / work.<br><br>The trap window contains detailed information to help locate the position of the problem in the source code plus infomation about what was happening at the time the error occured. The information in the trap window is arranged in three colums, each colum can contain blue diamonds (see the developer manual more more details on blue diamonds). The first column contains procedure names and underneath the procedure name local variables in that procedure. The second column contains information on the type of the local variable. The third column gives the value of the local variable. The first procedure in the left hand column is where the error causing the trap occurred, clicking on the blue diamond in the second coulumn on a level with this procedure name will open a window showing the source code of the procedure and the exact position where the error occured. The second procedure name in the first column is the procedure which called the procedure where the error occured and so on. The blue diamonds on the left side of the first column give information about global variables in the module which encloses the procedure, clicking on these blue diamonds will open a new window showing the global variable. Blue diamonds to the right of the third column give information about pointer type variables, while the folds like </font><font face="Arial" color="#000100" size="1">fields</font><font face="Arial" color="#000100" size="3"> give information about structured variables. <br><br>A section of a typical trap widow is shown below (in this case </font><font face="Arial" color="#000100" size="1"><strong>TRAP 0</strong></font><font face="Arial" color="#000100" size="3"> is a special, deliberate -that is programmed - error).<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="tipstroubleshooting3.bmp" alt="[tipstroubleshooting3]"><br><br><br>Some common illegal actions detected by the run time system are:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">a) </font><font face="Arial" color="#000100" size="3"><strong>'undefined real result' </strong></font><font face="Arial" color="#000100" size="3">indicates numerical overflow. Possible reasons include:<br>- initial values generated from a 'vague' prior distribution may be numerically extreme - specify appropriate initial values;<br>- numerically impossible values such as log of a non-positive number - check, for example, that no zero expectations have been given when Poisson modelling;<br>- numerical difficulties in sampling. Possible solutions include:<br>- better initial values;<br>- more informative priors - uniform priors might still be used but with their range restricted to plausible values;<br>- better parameterisation to improve orthogonality;<br>- standardisation of covariates to have mean 0 and standard deviation 1.<br>- can happen if all initial values are equal.<br><br>b) </font><font face="Arial" color="#000100" size="3"><strong>'index array out of range' - </strong></font><font face="Arial" color="#000100" size="3">possible reasons include:<br>- attempting to assign values beyond the declared length of an array;<br><br>c) </font><font face="Arial" color="#000100" size="3"><strong>'stack overflow' </strong></font><font face="Arial" color="#000100" size="3">can occur if there is a recursive definition of a logical node.<br><br>d) </font><font face="Arial" color="#000100" size="3"><strong>'NIL dereference (read)' </strong></font><font face="Arial" color="#000100" size="3">can occur at compilation in some circumstances when an inappropriate transformation is made, for example an array into a scalar.<br><br>e) </font><font face="Arial" color="#000100" size="3"><strong>argument of Sqrt must not be negative</strong></font><font face="Helvetica" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="3">the square root of a negative number has been taken, this occurs if the precision matrix of a multivariate normal is not posative definite.</font><font face="Helvetica" color="#000100" size="2"><br><br></font><font face="Arial" color="#000100" size="2"><strong><br></strong></font><font face="Courier New" color="#000100" size="5"><a id="TheProgramHangs">The program hangs</a></font><font face="Arial" color="#000100" size="2"> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">This could be due to:<br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">a) a problem that seems to happen with NT - rebooting is a crude way out;<br>b) interference with other programs running - try to run WinBUGS on its own;<br>c) a particularly ill-posed model - try the approaches listed above under Trap messages.<br><br></font><font face="Arial" color="#000100" size="2"><br><a id="SpeedingUpSampling"></font><font face="Courier New" color="#000100" size="5">Speeding up sampling</font><font face="Arial" color="#000100" size="2"></a> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">The key is to reduce function evaluations by expressing the model in as concise a form as possible. For example, take advantage of the functions provided and use nested indexing wherever possible. Look at the packaged examples and others provided on users' web sites.<br><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Courier New" color="#000100" size="5"><a id="ImprovingConvergence">Improving convergence</font><font face="Arial" color="#000100" size="2"></a> </font><font face="Courier New" color="#0000FF" size="3">[<a href="#Contents">top</a>]</font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3">Possible solutions include:</font><font face="Arial" color="#000100" size="2"><br><br></font><font face="Arial" color="#000100" size="3">a) better parameterisation to improve orthogonality of joint posterior;<br>b) standardisation of covariates to have mean 0 and standard deviation 1;<br>c) use of ordered over-relaxation.<br></font><font face="Arial" color="#000100" size="3"><strong><br></strong></font><font face="Arial" color="#000100" size="3">For other problems, try the FAQ pages of the web site and the Classic BUGS manual. Then try mailing us on bugs@mrc-bsu.cam.ac.uk.<br><br>Please try and keep the discussion list for modelling issues and problems other than</font><font face="Arial" color="#000100" size="3"><strong> </strong></font><font face="Arial" color="#000100" size="3"><em>my program won't run!</em></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="2"><strong><br></strong></font></p></body></html>